# Episode.Carthage 

## 서론. 
캠프톡 iOS 프로젝트는 클린 후 빌드시 평균적으로 **600초(10분)** 가량의 빌드 시간이 필요하고, 컴퓨터가 바쁘다면 +@로 시간이 더 필요함. 이에 스트레스를 받은 필자는 빌드시간을 줄여보기로 결심

## 원인
    
1. **리펙토링이 되지 않은 많은 사람들이 건드린 오래된 소스**
    * 오래전에 시작되었고, 목적도 달랐던 프로젝트가 한번 중단된 이후 다른 개발자가 인수 받아서 캠프톡으로 급하게 만든 history..
    * 사용하지 않는 소스/리소스가 프로젝트 내에 방치되어 있음
    * 프로젝트의 목적이 여러번 변경되었고 사람도 많이 타서 같은목적을 가진 이름만 상이한 클래스들이 존재 
    
2. **라이브러리 그리고 cocoapods**
    * 캠프톡 iOS 프로젝트에서 사용 하고 있는 라이브러리는 32개가 있었고, 프로젝트에 소스로 포함되어있는 오픈소스가 10개, CocoaPods로 관리되는 라이브러리가 22개 존재
    * CocoaPods는 프로젝트 빌드할때 Dependency도 함께 빌드 하기때문에 프로젝트가 커지고, 사용하는 라이브러리의 수가 증가하게 되면 이에 비례하여 전체 빌드 시간도 함께 증가 하게 됨  


## 해결방안
1. **프로젝트 정리정돈 (기존 프로젝트에 진행사항이 많이 있어서 일단 우선순위 밀림)**
    * 사용하지 않는 코드/리소스 찾아서 제거 
    * 리펙토링: 동일한 목적을 수행하는 코드/클래스 통합
    * 모듈화: STATIC한 코드 또는 리소스 모듈화 하여 Submodule로 사용  

2. **Dependency 관리 CocoaPods 에서 Carthage로 ...**
    * Carhage는 라이브러리 소스를 미리 빌드하여 Framework을 만들어 놓기때문에 프로젝트 빌드시에 Dependency와 상관없이 본 소스만 빌드를 하게 되어 그만큼 시간이 단축됨

## 처리 과정
* 프로젝트 내부에서 사용되는 모든 라이브러리를 CocoaPods로 통합하여 관리. (일부 변경사항이 있는 소스는 원소스를 Fork하여 수정사항 반영한 깃주소를 사용)
* Carthage를 지원하는 라이브러리는 Carthage로 적용 
* Carthage를 지원하지 않는 라이브러리는 원소스 Fork후 Carthage 지원 되게끔 적용후 반영한 깃주소를 사용

## 결과
* 기존 `600+@초*` 에서 **`280~300초`** 로 빌드시간이 50% 이상 감소

## 결론
생각보다 좋은 결과가 나왔고, 모듈화까지 진행한다면 빌드에 필요한 시간이 1~2분대가 될 것으로 확신 갖게됨  

## Behind 
* 일정은 넉넉하게 5일 잡고, 2~3일이면 끝나겠다 싶어서 진행 하였으나 결과적으로 2주 (10일) 걸림 (문서까지...)
* 처음에는 사이즈가 큰 몇몇개만 Carthage로 옮겨서 테스트를 해볼 생각이였으나...라이브러리끼리 서로 의존하고 있는 부분이 예상보다 복잡하여 CocoaPods로 먼저 통합 후 전체적으로 Cartage로 변경하는 작업을 하게 됨
* 생각보다 많은 라이브러리들이 Cartage를 지원한다고 표시했지만 실제로 빌드가 안되는게 많았음 (PullRequest 할 목적으로 모두 Fork하여 적용함)
